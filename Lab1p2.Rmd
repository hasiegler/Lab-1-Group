---
title: "Lab 1: Part 2"
author: "Michael Knauss"
date: "4/5/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
library(tidyverse)
library(modelr)
```

```{r}
oscars <- read_csv("Oscars-demographics-DFE.csv")
head(oscars)
```

# Data Analysis

### Warm Ups
1. Which movie(s) won the most unique "Big 5" awards?
There are 14 movies that won three of the five unique awards.
```{r}
big5 <- oscars %>%
  group_by(movie) %>%
  distinct(award) %>%
  count(movie) %>%
  arrange(desc(n))

head(big5)
```
2. Of all actresses who have won the Best Actress award, what is the most common first name?
The most common first name of actresses who won the Best Actress award is 'Helen' at 3. 
```{r}
name <- oscars %>% 
  distinct(person, .keep_all = TRUE) %>%
  filter(award == "Best Actress") %>%
  pull(person) %>%
  word(1) %>%
  table() %>% 
  sort(decreasing = TRUE)

head(name)
```
3. What US State, or non-US country, has produced the most Oscar winners (for the awards in this dataset)?
New York was the state or country that produced the most Oscar winners in the dataset with 56.
```{r}
oscars$birthplace <- gsub("New York City", 'New York City, Ny', oscars$birthplace)

state <- oscars %>% 
  distinct(person, .keep_all = TRUE) %>%
  pull(birthplace) %>%
  word(-1) %>%
  table() %>% 
  sort(decreasing = TRUE)

head(state)
```

### Age and Gender
I created a linear model that attempts to predict the age of the oscars winner using the year they won and their gender. The model should be able to show us how the age of the average winner has changed over time as well as if male and female groups win different number of awards or if their average age evolved differently over time.
From this model we can say that there is moderate to strong evidence (pvalue = 0.0517) that the average age of winners is changing over time and we have very strong evidence that males and female winners are of different average ages. The interaction term was removed from the model because it was not significant, telling us that the average age changed over time similar for both male and female groups.
The model estimates that the average age of winners increases by about three weeks (1/18th of a year) each year as well as estimating that the average male winner is 9.5 years older than the average female winner.
```{r}
oscars$date_of_birth[85] <- "5-Oct-1972"
oscars$date_of_birth[55] <- "18-Aug-1936"

modeldata <- oscars %>%
  separate(date_of_birth, into = c("day", "month", "year"), sep = "-") %>%
  mutate(
    day = as.numeric(day),
    year = as.numeric(year)
    ) %>%
  mutate(
    year = case_when(year < 100 ~ 1900 + year,TRUE ~ year)
    )%>%
  mutate(
    age = year_of_award - year,
    gender = case_when(
      award == "Best Actress" ~ "Female",
      award == "Best Supporting Actress" ~ "Female",
      award == "Best Actor" ~ "Male",
      award == "Best Supporting Actor" ~ "Male",
      TRUE ~ "NA"
    )) %>%
  filter(gender %in% c("Male", "Female"))

ggplot(aes(x = year_of_award, y = age, color = gender), data = modeldata) +
  geom_point() +
  geom_smooth(method = "lm")


model <- lm(age ~ year_of_award+gender, data = modeldata)
summary(model)
```

### Bootstrapping
We are 95% confident that the true proportion of non-white oscars big 5 award winners is between 4.54% and 9.30%. The rejection regions for a hypothesis test for this proportion are shaded on the graph.
```{r}
notwhite <- oscars %>% 
  mutate(
    ethnicity = case_when(
      race_ethnicity != "White" ~ 1,
      TRUE ~ 0
    )
  ) %>% 
  select(ethnicity)

boot <- bootstrap(notwhite,1000)
boot <- mutate(boot, prop = map_dbl(strap, ~mean(data.frame(.x)$ethnicity)))

#Confidence Interval
lower = quantile(boot$prop, 0.025)
upper = quantile(boot$prop, 0.975)


p <- boot %>% 
  ggplot() +
  geom_density(aes(x = prop, y = ..density..), fill = "grey") 
  
mapdata <- ggplot_build(p)$data[[1]]

p <-  p + 
  geom_area(aes(x=x, y=y), data = subset(mapdata, x < lower), fill = "red") + 
  geom_area(aes(x=x, y=y), data = subset(mapdata, x > upper), fill = "red") +
  ggtitle("Bootstraped Distribution of Proportions of Non-White Oscar Winners")
p
```